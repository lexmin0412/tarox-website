(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{173:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return o})),t.d(n,"metadata",(function(){return i})),t.d(n,"rightToc",(function(){return s})),t.d(n,"default",(function(){return p}));var r=t(2),a=t(9),c=(t(0),t(182)),o={id:"h5_001",title:"H5\u5b9a\u4f4d\u7ec8\u6781\u89e3\u51b3\u65b9\u6848"},i={id:"h5_001",isDocsHomePage:!1,title:"H5\u5b9a\u4f4d\u7ec8\u6781\u89e3\u51b3\u65b9\u6848",description:"\u80cc\u666f",source:"@site/docs/H5_H5\u5b9a\u4f4d\u7ec8\u6781\u89e3\u51b3\u65b9\u6848.md",permalink:"/my-blog-docusaurus/docs/h5_001",editUrl:"https://github.com/cathe-zhang/my-blog-docusaurus/tree/dev/docs/H5_H5\u5b9a\u4f4d\u7ec8\u6781\u89e3\u51b3\u65b9\u6848.md",sidebar:"someSidebar",previous:{title:"Taro\u9879\u76ee\u89c4\u8303",permalink:"/my-blog-docusaurus/docs/taro_002"},next:{title:"H5\u7aef\u5e38\u89c1\u517c\u5bb9\u6027\u95ee\u9898\u89e3\u51b3\u65b9\u6848",permalink:"/my-blog-docusaurus/docs/h5_002"}},s=[{value:"\u80cc\u666f",id:"\u80cc\u666f",children:[]},{value:"\u76ee\u6807\u4e0e\u5206\u6790",id:"\u76ee\u6807\u4e0e\u5206\u6790",children:[]},{value:"\u89e3\u51b3\u65b9\u6848",id:"\u89e3\u51b3\u65b9\u6848",children:[{value:"1. \u5728\u5fae\u4fe1\u5916H5\uff0c\u901a\u8fc7\u817e\u8baf\u5730\u56fe jsapi \u83b7\u53d6\u4f4d\u7f6e",id:"1-\u5728\u5fae\u4fe1\u5916h5\uff0c\u901a\u8fc7\u817e\u8baf\u5730\u56fe-jsapi-\u83b7\u53d6\u4f4d\u7f6e",children:[]},{value:"2. \u5728\u5fae\u4fe1\u5185H5\u9875\u9762, \u901a\u8fc7\u5fae\u4fe1 jssdk \u83b7\u53d6\u4f4d\u7f6e\u4fe1\u606f",id:"2-\u5728\u5fae\u4fe1\u5185h5\u9875\u9762-\u901a\u8fc7\u5fae\u4fe1-jssdk-\u83b7\u53d6\u4f4d\u7f6e\u4fe1\u606f",children:[]},{value:"3. \u9875\u9762\u8c03\u7528",id:"3-\u9875\u9762\u8c03\u7528",children:[]}]},{value:"\u603b\u7ed3",id:"\u603b\u7ed3",children:[]}],l={rightToc:s};function p(e){var n=e.components,t=Object(a.a)(e,["components"]);return Object(c.b)("wrapper",Object(r.a)({},l,t,{components:n,mdxType:"MDXLayout"}),Object(c.b)("h2",{id:"\u80cc\u666f"},"\u80cc\u666f"),Object(c.b)("p",null,"\u6700\u8fd1\u516c\u53f8\u7684\u9879\u76ee\u662f\u4e00\u4e2aH5\u7aef\u7684\u5546\u57ce\uff0c\u4e3b\u8981\u5728\u5fae\u4fe1\u5185\uff0c\u4f46\u4e5f\u8981\u8003\u8651\u5230\u5176\u4ed6\u6d4f\u89c8\u5668\u3002\u5176\u4e2d\uff0c\u9996\u9875\u9700\u8981\u6839\u636e\u5f53\u524d\u7528\u6237\u7684\u7ecf\u7eac\u5ea6\u627e\u5230\u8ddd\u79bb\u6700\u8fd1\u7684\u95e8\u5e97\u5e76\u5c55\u793a\u3002\u524d\u7aef\u9700\u8981\u505a\u7684\u5de5\u4f5c\u5c31\u662f\u83b7\u53d6\u7528\u6237\u8bbe\u5907\u7684\u7ecf\u7eac\u5ea6\u7136\u540e\u67e5\u8be2\u540e\u53f0\u63a5\u53e3\u5e76\u6e32\u67d3\u9875\u9762\u3002"),Object(c.b)("h2",{id:"\u76ee\u6807\u4e0e\u5206\u6790"},"\u76ee\u6807\u4e0e\u5206\u6790"),Object(c.b)("p",null,"\u76ee\u6807\uff1a\u5c3d\u53ef\u80fd\u5730\u7b80\u5316\u8c03\u7528\u8fc7\u7a0b\u3002"),Object(c.b)("p",null,"\u6211\u4eec\u9700\u8981\u505a\u7684\u4e8b\u60c5\u662f\uff0c\u9488\u5bf9\u4e0d\u540c\u7684\u7aef\uff08\u5fae\u4fe1H5\u548c\u5176\u4ed6\u6d4f\u89c8\u5668\u73af\u5883\uff09\u5c01\u88c5\u4e0d\u540c\u7684\u65b9\u6cd5\uff0c\u518d\u6839\u636e\u4e0d\u540c\u73af\u5883\u8c03\u7528\u5bf9\u5e94\u7684\u65b9\u6cd5\u83b7\u53d6\u4f4d\u7f6e\u3002"),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"\u5728\u5fae\u4fe1\u5185\u90e8\uff0c\u7ecf\u8fc7\u53cd\u590d\u7684\u5b9e\u8df5\u4e4b\u540e\uff0c\u4e0d\u8bba\u662f\u901a\u8fc7\u539f\u751f\u7684 HTML5 \u5b9a\u4f4d\uff0c\u8fd8\u662f\u901a\u8fc7\u7b2c\u4e09\u65b9(\u5982\u767e\u5ea6\u6216\u817e\u8baf\u5730\u56fe) jsapi \u83b7\u53d6\u4f4d\u7f6e\uff0c\u4e0d\u4ec5\u5b9a\u4f4d\u65f6\u95f4\u957f\uff0c\u751a\u81f3\u7ecf\u5e38\u51fa\u73b0\u5b9a\u4f4d\u5931\u8d25\u7684\u60c5\u51b5\uff0c\u4e25\u91cd\u5f71\u54cd\u7528\u6237\u4f53\u9a8c\uff0c\u5c24\u5176\u5bf9\u4e8e\u5927\u90e8\u5206\u4fe1\u606f\u6d41\u90fd\u4f9d\u8d56\u4e8e\u7528\u4e8e\u4f4d\u7f6e\u7684\u5546\u57ce\u9996\u9875\u6765\u8bf4\uff0c\u662f\u5b8c\u5168\u65e0\u6cd5\u63a5\u53d7\u7684\u3002\u6240\u4ee5\u5728\u5fae\u4fe1\u5185\u6211\u4eec\u53ea\u6709\u5fae\u4fe1 jssdk \u8fd9\u4e00\u79cd\u9009\u62e9\uff1b")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"\u5bf9\u4e8e\u6d4f\u89c8\u5668\u7aef\uff0c\u901a\u8fc7\u7b2c\u4e09\u65b9\u7684\u5730\u56fe jsapi \u6216\u5b9a\u4f4d\u7ec4\u4ef6\uff0c\u53ef\u4ee5\u7a33\u5b9a\u4e14\u8f83\u5feb\u901f\u5730\u83b7\u53d6\u4f4d\u7f6e\u4fe1\u606f\uff0c\u4e3a\u4e86\u4e0e\u5fae\u4fe1\u5185\u8868\u73b0\u5c3d\u91cf\u4fdd\u6301\u4e00\u81f4\uff0c\u6211\u4eec\u9009\u62e9\u7684\u662f\u817e\u8baf\u5730\u56fe jsapi\u3002")),Object(c.b)("li",{parentName:"ul"},Object(c.b)("p",{parentName:"li"},"\u5c0f\u7a0b\u5e8f\u7aef\u7684\u5b9a\u4f4d\u662f\u6700\u7b80\u5355\u7684\uff0c\u76f4\u63a5\u8c03\u7528\u5b98\u65b9\u7684 getLocation api\u5373\u53ef\u3002"))),Object(c.b)("table",null,Object(c.b)("thead",{parentName:"table"},Object(c.b)("tr",{parentName:"thead"},Object(c.b)("th",Object(r.a)({parentName:"tr"},{align:null}),"\u73af\u5883"),Object(c.b)("th",Object(r.a)({parentName:"tr"},{align:null}),"\u65b9\u6848"),Object(c.b)("th",Object(r.a)({parentName:"tr"},{align:null}),"\u5907\u6ce8"))),Object(c.b)("tbody",{parentName:"table"},Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(r.a)({parentName:"tr"},{align:null}),"\u5fae\u4fe1\u5916H5"),Object(c.b)("td",Object(r.a)({parentName:"tr"},{align:null}),"\u817e\u8baf\u5730\u56fe jsapi"),Object(c.b)("td",Object(r.a)({parentName:"tr"},{align:null}))),Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(r.a)({parentName:"tr"},{align:null}),"\u5fae\u4fe1\u5185H5"),Object(c.b)("td",Object(r.a)({parentName:"tr"},{align:null}),"\u5fae\u4fe1jssdk"),Object(c.b)("td",Object(r.a)({parentName:"tr"},{align:null}))),Object(c.b)("tr",{parentName:"tbody"},Object(c.b)("td",Object(r.a)({parentName:"tr"},{align:null}),"\u5fae\u4fe1\u5c0f\u7a0b\u5e8f"),Object(c.b)("td",Object(r.a)({parentName:"tr"},{align:null}),"wx.getLocation api"),Object(c.b)("td",Object(r.a)({parentName:"tr"},{align:null}))))),Object(c.b)("p",null,"\u7efc\u4e0a\uff0c\u6700\u7b80\u5316\u7684\u8c03\u7528\u5f62\u5f0f\u4e3a\uff0c\u8c03\u7528\u4e00\u4e2aPromise\u65b9\u6cd5\uff0c\u5728then\u56de\u8c03\u4e2d\u5904\u7406\u6210\u529f\u903b\u8f91\uff0c\u5728catch\u903b\u8f91\u4e2d\u5904\u7406\u5931\u8d25\u903b\u8f91\uff0c\u6240\u6709\u7684\u53ef\u590d\u7528\u7684\u903b\u8f91\u90fd\u62bd\u79bb\u5230\u5c01\u88c5\u7684Promise\u65b9\u6cd5\u4e2d\u53bb\u5904\u7406\u3002"),Object(c.b)("h2",{id:"\u89e3\u51b3\u65b9\u6848"},"\u89e3\u51b3\u65b9\u6848"),Object(c.b)("p",null,"Talk is cheap, show me the code. \u5e9f\u8bdd\u4e0d\u591a\u8bf4\uff0c\u76f4\u63a5\u4e0a\u4ee3\u7801\uff1a"),Object(c.b)("h3",{id:"1-\u5728\u5fae\u4fe1\u5916h5\uff0c\u901a\u8fc7\u817e\u8baf\u5730\u56fe-jsapi-\u83b7\u53d6\u4f4d\u7f6e"},"1. \u5728\u5fae\u4fe1\u5916H5\uff0c\u901a\u8fc7\u817e\u8baf\u5730\u56fe jsapi \u83b7\u53d6\u4f4d\u7f6e"),Object(c.b)("h4",{id:"11-\u5728\u9879\u76ee\u7684-html-\u6a21\u7248\u6587\u4ef6\u4e2d\u5f15\u5165\u817e\u8baf\u5730\u56fe-jsapi"},"1.1 \u5728\u9879\u76ee\u7684 html \u6a21\u7248\u6587\u4ef6\u4e2d\u5f15\u5165\u817e\u8baf\u5730\u56fe jsapi"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-html"}),'\x3c!-- index.html --\x3e\n<script charset="utf-8" src="https://map.qq.com/api/js?v=2.exp&key=\u817e\u8baf\u5730\u56fekey&referer=\u5e94\u7528\u540d\u79f0"><\/script>\n')),Object(c.b)("p",null,"\u8bf4\u660e\uff1a"),Object(c.b)("p",null,"\u4f7f\u7528\u817e\u8baf\u5730\u56fe jsapi, \u9700\u8981\u5148\u53bb\u817e\u8baf\u5730\u56fe\u5f00\u653e\u5e73\u53f0\u7533\u8bf7\u81ea\u5df1\u7684\u8d26\u53f7\uff0c\u7136\u540e\u521b\u5efa\u81ea\u5df1\u7684\u5e94\u7528\uff0c\u5c06\u817e\u8baf\u5730\u56fekey \u548c\u521b\u5efa\u7684\u5e94\u7528\u540d\u79f0\u66ff\u6362\u4e0a\u9762\u7684\u503c\u3002"),Object(c.b)("h4",{id:"12-\u8c03\u7528\u83b7\u53d6\u4f4d\u7f6e\u63a5\u53e3\uff0c\u83b7\u53d6\u4f4d\u7f6e\u4fe1\u606f"},"1.2 \u8c03\u7528\u83b7\u53d6\u4f4d\u7f6e\u63a5\u53e3\uff0c\u83b7\u53d6\u4f4d\u7f6e\u4fe1\u606f"),Object(c.b)("p",null,"\u4e3a\u4e86\u65b9\u4fbf\u590d\u7528\uff0c\u6211\u4eec\u5355\u72ec\u5c01\u88c5\u4e00\u4e2a\u817e\u8baf\u5730\u56fe jsapi \u7684\u7c7b\uff0c\u547d\u540d\u4e3a tMap.js"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"// tMap.js\nconst qq = window.qq\nvar geolocation = null\nif (qq && qq.maps) {\n  // \u521d\u59cb\u5316\u5b9a\u4f4d\u7ec4\u4ef6\n  geolocation = new qq.maps.Geolocation(\n    'QVLBZ-YUULR-OUMW7-WKXFD-4SRS-UDBQA',\n    'mymap'\n  )\n}\n\nclass TMap {\n  // \u83b7\u53d6\u5b9a\u4f4d\u8ba1\u6570\u5668 \u7528\u4e8e\u5b9a\u4f4d\u5931\u8d25\u65f6\u7d2f\u8ba1\u6b21\u6570 \u8d85\u8fc73\u6b21\u540e\u4e0d\u518d\u7ee7\u7eed\uff0c\u629b\u51fa\u5b9a\u4f4d\u5931\u8d25\u9519\u8bef\n  getPositionCount = 0\n\n  // \u5bf9\u5916\u66b4\u9732\u7684\u83b7\u53d6\u4f4d\u7f6e\u63a5\u53e3\n  getLocation () {\n    return new Promise((resolve, reject) => {\n      // \u5b9a\u4f4d\u6210\u529f\u56de\u8c03\n      this.getTMapLocation(resolve, reject)\n    })\n  }\n\n  // \u8c03\u7528\u817e\u8baf\u5730\u56fe\u83b7\u53d6\u4f4d\u7f6e\n  getTMapLocation (success, fail) {\n    const _self = this\n\n    // \u5b9a\u4f4d\u6210\u529f\u56de\u8c03\n    const showPosition = position => {\n      uni.setStorage({\n        key: 'positionData',\n        data: position\n      })\n      success(position)\n    }\n\n    // \u5b9a\u4f4d\u5931\u8d25\u56de\u8c03\n    const showErr = (err) => \n      // \u5982\u679c\u83b7\u53d6\u5b9a\u4f4d\u5931\u8d25\u8d85\u8fc73\u6b21 \u629b\u51fa\u9519\u8bef \u5426\u5219\u7ee7\u7eed\u83b7\u53d6\u5b9a\u4f4d\u4fe1\u606f\n      if (this.getPositionCount > 3) {\n        fail('\u8d85\u8fc73\u6b21 \u83b7\u53d6\u5b9a\u4f4d\u5931\u8d25')\n      } else {\n        // \u5b9a\u4f4d\u5931\u8d25\u9012\u5f52\n        _self.getPositionCount = _self.getPositionCount + 1\n        _self.getTMapLocation(success, fail)\n      }\n    }\n\n    // \u8c03\u7528\u817e\u8bafweb\u5b9a\u4f4d\u7ec4\u4ef6\u83b7\u53d6\u4f4d\u7f6e\u4fe1\u606f\n    if (geolocation) {\n      geolocation.getIpLocation(showPosition, showErr, {\n        timeout: 6000,  // \u5b9a\u4f4d\u8d85\u65f6\u65f6\u957f \u5355\u4f4dms\n        failTipFlag: true\n      })\n    }\n  }\n}\n\nexport default new TMap()\n")),Object(c.b)("h3",{id:"2-\u5728\u5fae\u4fe1\u5185h5\u9875\u9762-\u901a\u8fc7\u5fae\u4fe1-jssdk-\u83b7\u53d6\u4f4d\u7f6e\u4fe1\u606f"},"2. \u5728\u5fae\u4fe1\u5185H5\u9875\u9762, \u901a\u8fc7\u5fae\u4fe1 jssdk \u83b7\u53d6\u4f4d\u7f6e\u4fe1\u606f"),Object(c.b)("h4",{id:"21-\u5fae\u4fe1-jssdk-\u76f8\u5173\u7684\u51c6\u5907\u5de5\u4f5c"},"2.1 \u5fae\u4fe1 jssdk \u76f8\u5173\u7684\u51c6\u5907\u5de5\u4f5c"),Object(c.b)("h5",{id:"211-\u5f15\u5165js\u6587\u4ef6"},"2.1.1 \u5f15\u5165js\u6587\u4ef6"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"/**\n * \u5fae\u4fe1sdk\u5f02\u6b65\u52a0\u8f7d\n * @param {*} src\n * @param {*} callback api\u63a5\u53e3\n */\nexport const handlerLoadScript = callback => {\n  const src = `https://res.wx.qq.com/open/js/jweixin-1.4.0.js`\n  if (!(typeof callback === 'function')) {\n    callback = function() {}\n  }\n  var check = document.querySelectorAll(`script[src=\"${src}\"]`)\n  if (check.length > 0) {\n    check[0].addEventListener('load', function() {\n      callback()\n    })\n    callback()\n    return\n  }\n  var script = document.createElement('script')\n  var head = document.getElementsByTagName('head')[0]\n  script.type = 'text/javascript'\n  script.charset = 'UTF-8'\n  script.src = src\n  if (script.addEventListener) {\n    script.addEventListener(\n      'load',\n      function() {\n        callback()\n      },\n      false\n    )\n  } else if (script.attachEvent) {\n    script.attachEvent('onreadystatechange', function() {\n      var target = window.event.srcElement\n      if (target.readyState === 'loaded') {\n        callback()\n      }\n    })\n  }\n  head.appendChild(script)\n}\n")),Object(c.b)("h5",{id:"212-\u6ce8\u5165\u6743\u9650\u9a8c\u8bc1\u914d\u7f6e"},"2.1.2 \u6ce8\u5165\u6743\u9650\u9a8c\u8bc1\u914d\u7f6e"),Object(c.b)("p",null,"\u6240\u6709\u9700\u8981\u4f7f\u7528JS-SDK\u7684\u9875\u9762\u5fc5\u987b\u5148\u6ce8\u5165\u914d\u7f6e\u4fe1\u606f\uff0c\u5426\u5219\u5c06\u65e0\u6cd5\u8c03\u7528\u3002\u901a\u5e38\u662f\u901a\u8fc7\u540e\u53f0\u63a5\u53e3\u83b7\u53d6\u914d\u7f6e\u4fe1\u606f\u3002"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"/**\n * \u6ce8\u5165\u6743\u9650\u9a8c\u8bc1\u914d\u7f6e\n * @param {object} \u5fae\u4fe1 js-sdk \u6743\u9650\u9a8c\u8bc1\u914d\u7f6e\n */\nexport const wxconfigInfo = config => {\n  wx.config({\n    debug: false, // \u5f00\u542f\u8c03\u8bd5\u6a21\u5f0f,\u8c03\u7528\u7684\u6240\u6709api\u7684\u8fd4\u56de\u503c\u4f1a\u5728\u5ba2\u6237\u7aefalert\u51fa\u6765\uff0c\u82e5\u8981\u67e5\u770b\u4f20\u5165\u7684\u53c2\u6570\uff0c\u53ef\u4ee5\u5728pc\u7aef\u6253\u5f00\uff0c\u53c2\u6570\u4fe1\u606f\u4f1a\u901a\u8fc7log\u6253\u51fa\uff0c\u4ec5\u5728pc\u7aef\u65f6\u624d\u4f1a\u6253\u5370\u3002\n    appId: config.appId,\n    timestamp: parseInt(config.timestamp),\n    nonceStr: config.nonceStr,\n    signature: config.signature,\n    jsApiList: [   // \u9700\u8981\u4f7f\u7528\u7684 jsapi \u5217\u8868\n      ...,\n      'getLocation'  // \u83b7\u53d6\u5730\u7406\u4f4d\u7f6e\n    ]\n  })\n}\n")),Object(c.b)("h5",{id:"22-\u8c03\u7528-api-\u83b7\u53d6\u4f4d\u7f6e\u4fe1\u606f"},"2.2 \u8c03\u7528 api \u83b7\u53d6\u4f4d\u7f6e\u4fe1\u606f"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"})," /**\n * \u5fae\u4fe1\u83b7\u53d6\u4f4d\u7f6e\n */\nexport const handleGetLocation = (config) => {\n  return new Promise((resolve, reject)=>{\n    wxconfigInfo(config)\n    wx.ready(function () {\n      wx.getLocation({\n        type: 'wgs84', // \u9ed8\u8ba4\u4e3awgs84\u7684gps\u5750\u6807\uff0c\u5982\u679c\u8981\u8fd4\u56de\u76f4\u63a5\u7ed9openLocation\u7528\u7684\u706b\u661f\u5750\u6807\uff0c\u53ef\u4f20\u5165'gcj02'\n        success: function (res) {\n          console.warn('\u5fae\u4fe1sdk\u5b9a\u4f4d\u6210\u529f', res)\n          resolve({\n            lat: res.latitude, // \u7eac\u5ea6\n            lng: res.longitude, // \u7ecf\u5ea6\n            speed: res.speed, // \u901f\u5ea6\uff0c\u4ee5\u7c73/\u6bcf\u79d2\u8ba1\n            accuracy: res.accuracy // \u4f4d\u7f6e\u7cbe\u5ea6\n          })\n        },\n        fail: function (err) {\n          console.error('\u5fae\u4fe1sdk\u5b9a\u4f4d\u5931\u8d25', err)\n          reject(err)\n        }\n      })\n    })\n    wx.error(function(err) {\n      // config\u4fe1\u606f\u9a8c\u8bc1\u5931\u8d25\u4f1a\u6267\u884cerror\u51fd\u6570\uff0c\u5982\u7b7e\u540d\u8fc7\u671f\u5bfc\u81f4\u9a8c\u8bc1\u5931\u8d25\uff0c\u5177\u4f53\u9519\u8bef\u4fe1\u606f\u53ef\u4ee5\u6253\u5f00config\u7684debug\u6a21\u5f0f\u67e5\u770b\uff0c\u4e5f\u53ef\u4ee5\u5728\u8fd4\u56de\u7684res\u53c2\u6570\u4e2d\u67e5\u770b\uff0c\u5bf9\u4e8eSPA\u53ef\u4ee5\u5728\u8fd9\u91cc\u66f4\u65b0\u7b7e\u540d\u3002\n      console.log('wxjsapi-error=', err)\n      reject(`wxjsapi-error: ${err}`)\n    })\n  })\n")),Object(c.b)("h4",{id:"23-\u6839\u636e\u4e0d\u540c\u8fd0\u884c\u73af\u5883\u8c03\u7528\u4e0d\u540c\u7684\u5b9a\u4f4d\u65b9\u6cd5"},"2.3 \u6839\u636e\u4e0d\u540c\u8fd0\u884c\u73af\u5883\u8c03\u7528\u4e0d\u540c\u7684\u5b9a\u4f4d\u65b9\u6cd5"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"// public.js\n\n/**\n * UA\u679a\u4e3e\n */\nconst UA = {\n  /**\n   * \u5fae\u4fe1h5\n   */\n  WECHAT: 'WECHAT',\n  /**\n   * \u652f\u4ed8\u5b9dh5\n   */\n  ALIPAY: 'ALIPAY',\n  /**\n   * \u5176\u4ed6\n   */\n  OTHERS: 'OTHERS'\n}\n\n\n/**\n * \u5224\u65ad\u5ba2\u6237\u7aef\u8fd0\u884c\u73af\u5883 \u8fd9\u91cc\u53ea\u5224\u65ad\u5fae\u4fe1\u548c\u6d4f\u89c8\u5668h5\n */\n/**\n   * TODO: \u540e\u7eed\u4f18\u5316\u5224\u65ad \u62bd\u79bb\u679a\u4e3e\n   * \u5224\u65ad\u5ba2\u6237\u7aef\u8fd0\u884c\u73af\u5883 \u6682\u65f6\u53ea\u6709h5 \u540e\u7eed\u53ef\u6269\u5c55\u5c0f\u7a0b\u5e8f/app\u7b49\u7aef\n   */\n  getUserAgent = () => {\n    console.log('process.env.TARO_ENV===', process.env.TARO_ENV)\n    if (process.env.TARO_ENV === 'weapp') {\n      // \u5fae\u4fe1\u5c0f\u7a0b\u5e8f\n      return 'WEAPP'\n    } else {\n      // h5\n      if (navigator) {\n        const userAgent: any = navigator.userAgent.toLowerCase()\n        if (userAgent.match(/Alipay/i) == 'alipay') {\n          return this.USER_AGENT.ALIPAY\n        } else if (userAgent.match(/MicroMessenger/i) ==   'micromessenger') {\n          return this.USER_AGENT.WECHAT\n        } else {\n          return this.USER_AGENT.OTHERS\n        }\n      }\n    }\n  }\n")),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"// js-sdk.js\n/**\n * \u5524\u8d77\u5fae\u4fe1api\n * @param {*} _href \u5f53\u524d\u9875\u9762url\n * @param {*} options \u5206\u4eab\u4fe1\u606f\n * @param {*} apiType \u8c03\u7528api\u7c7b\u578b\n */\nexport const handleWXSDKCall = (_href, apiType, options) => {\n  return new Promise((resolve, reject)=>{\n    // \u901a\u8fc7\u540e\u53f0\u63a5\u53e3\u83b7\u53d6\u914d\u7f6e\u4fe1\u606f\n    WeChatServivce.sign(_href)\n      .then(res => {\n        if (res) {\n          if ( apiType === 'location' ) {\n            handleGetLocation(res).then((res)=>{\n              resolve(res)\n            }).catch(err=>{\n              reject(err)\n            })\n          }\n        }\n      })\n      .catch(err => {\n        reject(`err-sign: ${err}`)\n        uni.showToast({\n          title: err.data.code + err.data.msg,\n          mask: true,\n          icon: 'none'\n        })\n      })\n  })\n}\n")),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"// getLocation.js\nimport { getUserAgent, handlerLoadScript } from '@/module/utils'\nimport { handleWXSDKCall } from '@/module/utils/wechat/wxJsApiSdk'\nimport UA from '@/module/enums/userAgent'\nimport TMap from '@/module/utils/tMap'\n\n/**\n * \u5bf9\u5916\u66b4\u9732\u7684\u83b7\u53d6\u4f4d\u7f6e\u65b9\u6cd5\n * @return Promise resolve\u4e00\u4e2a positionData \u5bf9\u8c61 lat-\u7eac\u5ea6 lng-\u7ecf\u5ea6\n */\nconst getLocation = () => {\n  return new Promise((resolve, reject) => {\n    console.log('\u8fdb\u5165\u5168\u5c40\u83b7\u53d6\u7528\u6237\u4f4d\u7f6e\u65b9\u6cd5')\n    const storageData = uni.getStorageSync('positionData')\n    const userAgent = getUserAgent()\n    if (storageData) {\n      resolve(storageData)\n    } else {\n      // \u6839\u636e\u73af\u5883\u5224\u65ad \u5982\u679c\u5728\u5fae\u4fe1\u5185\u4f7f\u7528\u5fae\u4fe1sdk \u5176\u4ed6\u4f7f\u7528\u817e\u8baf\u5730\u56fe\u5b9a\u4f4d\u7ec4\u4ef6\n      if (userAgent === UA.WECHAT) {\n        handlerLoadScript(() => {\n          handleWXSDKCall(window.location.href, 'location').then((res) => {\n            uni.setStorageSync('positionData', res)\n            resolve(res)\n          }).catch(err => {\n            reject(err)\n          })\n        })\n      } else {\n        TMap.getLocation().then(res => {\n          uni.setStorageSync('positionData', res)\n          resolve(res)\n        }).catch((err) => {\n          reject(err)\n        })\n      }\n    }\n  })\n}\n\nexport default getLocation\n")),Object(c.b)("h3",{id:"3-\u9875\u9762\u8c03\u7528"},"3. \u9875\u9762\u8c03\u7528"),Object(c.b)("h4",{id:"31-\u7ed1\u5b9a\u65b9\u6cd5\u5230-vue-\u539f\u578b\u4e0a"},"3.1 \u7ed1\u5b9a\u65b9\u6cd5\u5230 Vue \u539f\u578b\u4e0a"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"import getLocation from '@/module/utils/getLocation'\nVue.prototype.$getLocation = getLocation\n")),Object(c.b)("h4",{id:"32-\u5728\u9875\u9762\u7ec4\u4ef6\u4e2d\u8c03\u7528"},"3.2 \u5728\u9875\u9762\u7ec4\u4ef6\u4e2d\u8c03\u7528"),Object(c.b)("pre",null,Object(c.b)("code",Object(r.a)({parentName:"pre"},{className:"language-js"}),"onShow() {\n  // \u83b7\u53d6\u4f4d\u7f6e\u4fe1\u606f\u540e\u8bf7\u6c42\u540e\u53f0\u63a5\u53e3\n  this.$getLocation()\n    .then(res => {\n      console.warn('\u9996\u9875\u83b7\u53d6\u4f4d\u7f6e\u6210\u529f', res)\n      this.latitude = res.lat\n      this.longitude = res.lng\n      // \u8fd9\u91cc\u6839\u636e\u83b7\u53d6\u5230\u7684\u7ecf\u7eac\u5ea6\u8bf7\u6c42\u540e\u53f0\u63a5\u53e3...\n    })\n    .catch(err => {\n      console.error('\u9996\u9875\u83b7\u53d6\u4f4d\u7f6e\u5931\u8d25', err)\n      // \u9519\u8bef\u5904\u7406\n    })\n}\n\n")),Object(c.b)("h2",{id:"\u603b\u7ed3"},"\u603b\u7ed3"),Object(c.b)("p",null,"\u9047\u5230\u7684\u5751\u4ee5\u53ca\u9700\u8981\u6ce8\u610f\u7684\u70b9\uff1a"),Object(c.b)("ol",null,Object(c.b)("li",{parentName:"ol"},"\u4f7f\u7528\u5fae\u4fe1sdk\u83b7\u53d6\u4f4d\u7f6e\u4fe1\u606f\u9700\u8981\u6309\u987a\u5e8f\u5b8c\u6210\u4ee5\u4e0b\u6b65\u9aa4\uff1a")),Object(c.b)("ul",null,Object(c.b)("li",{parentName:"ul"},"\u5f02\u6b65\u52a0\u8f7d\u5fae\u4fe1sdk"),Object(c.b)("li",{parentName:"ul"},"\u901a\u8fc7\u63a5\u53e3\u83b7\u53d6\u914d\u7f6e\u4fe1\u606f\uff0c\u914d\u7f6e\u5fae\u4fe1sdk"),Object(c.b)("li",{parentName:"ul"},"\u5728wx.ready\u56de\u8c03\u4e2d\u8c03\u7528\u65b9\u6cd5")),Object(c.b)("p",null,"\u5fc5\u987b\u4e25\u683c\u6309\u987a\u5e8f\u5b8c\u6210\u4ee5\u4e0a\u7684\u4e09\u4e2a\u6b65\u9aa4\uff0c\u5426\u5219\u662f\u65e0\u6cd5\u8c03\u7528\u5fae\u4fe1sdk\u7684\u529f\u80fd\u7684\u3002"),Object(c.b)("p",null,"\u603b\u4e4b\uff0c\u901a\u8fc7\u8fd9\u7bc7\u6587\u7ae0\uff0c\u53ef\u4ee5\u89e3\u51b3 H5 \u5b9a\u4f4d 99% \u4ee5\u4e0a\u7684\u5e94\u7528\u573a\u666f\u3002"))}p.isMDXComponent=!0},182:function(e,n,t){"use strict";t.d(n,"a",(function(){return b})),t.d(n,"b",(function(){return d}));var r=t(0),a=t.n(r);function c(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){c(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},c=Object.keys(e);for(r=0;r<c.length;r++)t=c[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)t=c[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=a.a.createContext({}),p=function(e){var n=a.a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},b=function(e){var n=p(e.components);return a.a.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.a.createElement(a.a.Fragment,{},n)}},j=a.a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,c=e.originalType,o=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),b=p(t),j=r,d=b["".concat(o,".").concat(j)]||b[j]||u[j]||c;return t?a.a.createElement(d,i(i({ref:n},l),{},{components:t})):a.a.createElement(d,i({ref:n},l))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var c=t.length,o=new Array(c);o[0]=j;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,o[1]=i;for(var l=2;l<c;l++)o[l]=t[l];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,t)}j.displayName="MDXCreateElement"}}]);